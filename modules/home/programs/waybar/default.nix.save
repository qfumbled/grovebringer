{ config, pkgs, lib, ... }: {
  options.funkouna.programs.waybar = {
    enable = lib.mkEnableOption "Enable waybar status bar";
  };

  config = lib.mkIf config.funkouna.programs.waybar.enable {
    programs.waybar = {
      enable = true;
      settings = [
        {
          layer = "top";
          position = "top";
          exclusive = true;
          passthrough = false;
          fixed-center = true;
          gtk-layer-shell = true;
          spacing = 0;
          name = "hobar";
          height = 40;
          modules-left = [
            "image"
            "hyprland/workspaces"
          ];
          modules-center = [
            "clock"
          ];
          modules-right = [
            "memory"
            "pulseaudio"
            "battery"
            "tray"
          ];

          "image" = {
            path = "${pkgs.nixos-icons}/share/icons/hicolor/scalable/apps/nix-snowflake.svg";
            size = 22;
            tooltip = false;
          };

          "hyprland/workspaces" = {
            format = "{id}";
            active-only = false;
            format-icons = {
              "1" = "Q";
              "2" = "W";
              "3" = "E";
              "4" = "R";
              "5" = "T";
              "6" = "Y";
              "7" = "U";
              "8" = "I";
              "9" = "O";
              "10" = "P";
            };
          };

          "group/backlight-modules" = {
            modules = [
              "backlight#icon"
              "backlight#percent"
            ];
            orientation = "inherit";
          };

          "backlight#icon" = {
            format = "{icon}";
            format-icons = [
              "󰃞"
              "󰃟"
              "󰃠"
            ];
            on-scroll-up = "${pkgs.brightnessctl}/bin/brightnessctl set 1%+ &> /dev/null";
            on-scroll-down = "${pkgs.brightnessctl}/bin/brightnessctl set 1%- &> /dev/null";
            tooltip-format = "Backlight: {percent}%";
          };

          "backlight#percent" = {
            format = "{percent}%";
            tooltip-format = "Backlight: {percent}%";
          };

          tray = {
            icon-size = 14;
            spacing = 14;
            show-passive-items = true;
            reverse-direction = true;
          };

          memory = {
            interval = 20;
            format = "MEM: [ {icon} ] <span size='8pt'>{percentage}%</span>";
            tooltip-format = "MEM_TOT\t: {total}GiB\nSWP_TOT\t: {swapTotal}GiB\n\nMEM_USD\t: {used:0.1f}GiB\nSWP_USD\t: {swapUsed:0.1f}GiB";
            format-icons = [
              "░░░░░░░░"
              "█░░░░░░░"
              "██░░░░░░"
              "███░░░░░"
              "████░░░░"
              "█████░░░"
              "██████░░"
              "<span color='#B7416E'>!!!!!!!!</span>"
              "<span color='#B7416E'>CRITICAL</span>"
            ];
          };

          battery = {
            states = {
              warning = 20;
              critical = 15;
            };
            format = "BAT= [ {icon} ] <span size='8pt'>{capacity}%</span>";
            interval = 5;
            format-charging = "BAT= [ {icon} ] <span size='8pt'>CHRG</span>";
            format-plugged = "BAT= [ {icon} ] <span size='8pt'>PLUG</span>";
            tooltip-format = "BATTERY= {power}W\nSTATUS= {timeTo}\nCYCLES= {cycles}\nHEALTH= {health}";
            format-icons = [
              "<span color='#B7416E'>CRITICAL"
              "<span color='#B7416E'>!!!!!!!!</span>"
              "██░░░░░░"
              "███░░░░░"
              "████░░░░"
              "█████░░░"
              "██████░░"
              "███████░"
x              "████████"
            ];
          };

          clock = {
            actions = {
              on-scroll-down = "shift_down";
              on-scroll-up = "shift_up";
            };
            calendar = {
              format = {
                days = "<span color='@theme_text_color'><b>{}</b></span>";
                months = "<span color='@theme_text_color'><b>{}</b></span>";
                today = "<span color='@theme_selected_bg_color'><b><u>{}</u></b></span>";
                weekdays = "<span color='@theme_fg_color'><b>{}</b></span>";
              };
              mode = "month";
              on-scroll = 1;
            };
            format = "{:%I:%M %p}";
            tooltip-format = "{calendar}";
          };
        }
      ];

      style = ''
        * {
            border: none;
            font-family: Rubik, Rubik;
            font-weight: 400;
            font-size: 13px;
            min-height: 0;
            padding: 0;
            border-radius: 0px;
        }

        window#waybar {
            background: @theme_bg_color;
            color: @theme_fg_color;
            padding: 0 12px;
        }

        tooltip {
            background: @theme_bg_color;
        }

        #workspaces button {
            color: @theme_fg_color;
            padding: 0 6px;
            margin: 0 1px;
            background: @theme_base_color;
            font-size: 14px;
            font-weight: 500;
        }

        #workspaces button.active {
            color: @theme_selected_bg_color;
            background: @theme_base_color;
            border-bottom: 2px solid @theme_selected_bg_color;
        }

        #workspaces button.focused {
            color: @theme_fg_color;
            background: @theme_base_color;
        }

        #workspaces button.urgent {
            color: @theme_fg_color;
            background: @theme_base_color;
        }

        #workspaces button:hover {
            background: @theme_fg_color;
            color: @theme_bg_color;
        }

        #custom-language,
        #custom-updates,
        #custom-caffeine,
        #custom-weather,
        #window,
        #clock,
        #battery,
        #pulseaudio,
        #network,
        #workspaces,
        #tray,
        #cpu,
        #backlight {
            background: @theme_base_color;
            padding: 0 14px;
            margin: 0 3px;
            border-radius: 0px;
        }

        #tray {
            margin-right: 8px;
            padding: 0 12px;
        }

        #workspaces {
            color: @theme_text_color;
        }

        #window {
            color: @theme_text_color;
        }

        #clock {
            color: @theme_text_color;
            font-weight: 400;
            font-size: 15px;
        }

        #network {
            color: @theme_text_color;
        }

        #pulseaudio {
            color: @theme_text_color;
        }

        #pulseaudio.microphone {
            color: @theme_text_color;
        }

        #battery {
            color: @theme_text_color;
        }

        #battery.warning:not(.charging) {
        	color: #C4E969;
        }

        #battery.critical:not(.charging) {
        	color: #B7416E;
        }

        #custom-weather {
            color: @theme_text_color;
        }
      '';
    };
  };
}
